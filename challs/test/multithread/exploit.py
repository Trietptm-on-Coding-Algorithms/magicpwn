#!/home/gym/.venvs/ctf/bin/python2
import os
import sys
from pwn import *

def do_something(c, nr):
    c.recvuntil('>')
    c.sendline(str(nr))
    if "Success" in c.recvuntil('>'):
        return True
    else:
        return False

def main(m, lock, arg):
    #l = m.load_libc()
    #e = m.load_elf()
    print "Start thread %d"%arg
    while not lock.locked():
        c = m.start()
        if not do_something(c, arg):
            c.close()
            continue
        else:
            lock.acquire()
            print("Found login: %d"%arg)
            c.interactive()

gdbs=[
    'c',
        ]
bp =[

        ]
if __name__ == "__main__":
    sys.path.append(os.path.expanduser('~/ctf/magicpwn'))
    try:
        from magicpwn import Magic
        #m = Magic('native', 'none', aslr=True, libc='local')
        m = Magic('remote', 'none', aslr=True, libc='local')
        #m = Magic('vm', 'none', aslr=True, libc='local')
        #context.log_level=logging.CRITICAL
        #context.log_file = 'log.txt'

        m.start_brute(main, 5, [0,1,2,3,4])
    except ImportError:
        c = process("./chall")

